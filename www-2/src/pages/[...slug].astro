---
import { getCollection, render } from 'astro:content';
import BaseLayout from './_base.astro';
import TableOfContents from '../components/TableOfContents.astro';

export async function getStaticPaths() {
	// Get all content collections that actually exist
	const collections = ['guides', 'reference', 'patterns'];

	const paths = [];

	for (const collectionName of collections) {
		try {
			const entries = await getCollection(collectionName);
			for (const entry of entries) {
				paths.push({
					params: { slug: entry.id },
					props: { entry, collectionName },
				});
			}
		} catch (e) {
			// Collection might not exist yet, skip it
			console.warn(`Collection ${collectionName} not found, skipping`);
		}
	}

	return paths;
}

const { entry } = Astro.props;
const { Content, headings } = await render(entry);
---

<BaseLayout title={entry.data.title} description={entry.data.description} tableOfContents={true}>
	<TableOfContents slot="toc" headings={headings} />
	<h1>{entry.data.title}</h1>
	<Content />
</BaseLayout>
