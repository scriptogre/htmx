---
interface Props {
    headings: Array<{
        depth: number;
        slug: string;
        text: string;
    }>;
}

const { headings } = Astro.props;

// Filter to only show h2 and h3 headings
const toc = headings.filter(h => h.depth <= 3);
---

{toc.length > 0 && (
<aside id="table-of-contents" class="hidden lg:block w-64 shrink-0 sticky top-48 self-start"
       _="init
            -- Detect all headings (h2, h3, h4) inside markdown content
            set headings to <main :is(h2,h3,h4)/> as Array
            js(me, headings)
              const observer = new IntersectionObserver(
                (entries) => entries.forEach(entry => {
                  if (entry.isIntersecting) {
                    _hyperscript.evaluate(`
                      take [@data-active] from .toc-link for first of <[href*='#${entry.target.getAttribute('id')}']/>
                    `);
                  }
                }),
                { rootMargin: '-120px 0px -75% 0px', threshold: 0 }
              );
              headings.forEach(h => observer.observe(h));
            end">
    <nav class="max-h-[calc(100vh-16rem)] overflow-y-auto">
        <h2 class="sticky top-0 z-10 text-sm font-bold text-neutral-900 dark:text-neutral-100 bg-neutral-50 dark:bg-neutral-900 mb-4 px-3 py-2">
            On This Page
        </h2>
        <div class="space-y-0.5">
            {toc.map((heading) => {
                const paddingClass = heading.depth === 2 ? 'pl-3' : heading.depth === 3 ? 'pl-6' : 'pl-9';
                return (
                    <a href={`#${heading.slug}`}
                       class={`toc-link block py-1.5 ${paddingClass} pr-3 text-sm
                                  text-neutral-700 dark:text-neutral-300
                                  hover:text-blue-600 dark:hover:text-blue-400
                                  hover:bg-neutral-50 dark:hover:bg-neutral-800
                                  data-active:text-blue-600
                                  data-active:dark:text-blue-400
                                  data-active:font-semibold
                                  data-active:border-l-2
                                  data-active:border-blue-600
                                  data-active:dark:border-blue-400`}>
                        {heading.text}
                    </a>
                );
            })}
        </div>
    </nav>
</aside>
)}
